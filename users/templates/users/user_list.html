{% extends "base.html" %}
{% load staticfiles %}

{# #! in this page #}
{#{% block title %}Index{% endblock title %}#}

{% block breadcurmb %}
    <li>
        <i class="ace-icon fa fa-home home-icon"></i>
        <a href={% url 'index' %}>申报须知</a>
    </li>
    <li class="active">用户列表</li>
{% endblock breadcurmb %}

{% block content %}
<h3 class="header smaller lighter blue">用户列表</h3>
<div class="table-header">
    列表
</div>

<!-- <div class="table-responsive"> -->

<!-- <div class="dataTables_borderWrap"> -->
<div>
    <table id="ajax_list" class="table table-striped table-bordered table-hover">
        <thead>
            <tr>
                <th class="center">
                    <label class="position-relative">
                        <input type="checkbox" class="ace" />
                        <span class="lbl"></span>
                    </label>
                </th>
                <th>用户名</th>
                <th>身份证号</th>
                <th class="hidden-480">Email</th>
                <th>操作</th>
            </tr>
        </thead>

        <tbody>
        {% for user in list %}
            <tr id={{ user.signid }}>
                <td class="center">
                    <label class="position-relative">
                        <input type="checkbox" class="ace" />
                        <span class="lbl"></span>
                    </label>
                </td>

                <td>{{ user.signid }}</td>
                <td>{{ user.idnumber }}</td>
                <td class="hidden-480">{{ user.email }}</td>
                <td>
                    <div class="hidden-sm hidden-xs action-buttons">
                        <form class="form-inline" method="post" action={% url 'user_list' %}>
                            {% csrf_token %}
                            <input type="hidden" name="ad_signid" value="{{ user.signid }}" />
                            <input type="submit" class="btn btn-info btn-minier" value="详情" />
                            <button name="{{ user.signid }}" type="button" class="btn btn-danger btn-minier del_ajax">删除</button>
                        </form>
                    </div>


                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<div id="dialog-confirm" class="hide">
        <div class="alert alert-info bigger-110">
            删除用户后将同时删除其所有申报公司以及相关技术人员、项目。
        </div>

        <div class="space-6"></div>

        <p class="bigger-110 bolder center grey">
            <i class="ace-icon fa fa-hand-o-right blue bigger-120"></i>
            确定删除吗？
        </p>
    </div><!-- #dialog-confirm -->

{% endblock content %}

{% block other_js %}

<script>
    jQuery(function($) {
        // TO set the nav_left_list; it will be rewrite in every page
        $('#nav_list_userlist').attr('class', 'active');
    })
</script>

<!-- page specific plugin scripts -->
<script src="{% static "js/jquery.dataTables.min.js" %}" ></script>
<script src="{% static "js/jquery.dataTables.bootstrap.js" %}" ></script>


<script src="{% static "js/jquery-ui.min.js" %}" ></script>
<script src="{% static "js/jquery.ui.touch-punch.min.js" %}" ></script>

<!-- inline scripts related to this page -->
<script type="text/javascript">

    jQuery(function($) {
        var oTable1 =
        $('#ajax_list')
        //.wrap("<div class='dataTables_borderWrap' />")   //if you are applying horizontal scrolling (sScrollX)
        .dataTable( {
            bAutoWidth: false,
            "aoColumns": [
              { "bSortable": false },
              null, null,null,         // #! Here is very important for me to build table!!!!!!
              { "bSortable": false }
            ],
            "aaSorting": [],
            language: {
                "sProcessing": "处理中...",
                "sLengthMenu": "显示 _MENU_ 项结果",
                "sZeroRecords": "没有匹配结果",
                "sInfo": "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
                "sInfoEmpty": "显示第 0 至 0 项结果，共 0 项",
                "sInfoFiltered": "(由 _MAX_ 项结果过滤)",
                "sInfoPostFix": "",
                "sSearch": "搜索:",
                "sUrl": "",
                "sEmptyTable": "表中数据为空",
                "sLoadingRecords": "载入中...",
                "sInfoThousands": ",",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "上页",
                    "sNext": "下页",
                    "sLast": "末页"
                    }
                },
            //,
            //"sScrollY": "200px",
            //"bPaginate": false,

            //"sScrollX": "100%",
            //"sScrollXInner": "120%",
            //"bScrollCollapse": true,
            //Note: if you are applying horizontal scrolling (sScrollX) on a ".table-bordered"
            //you may want to wrap the table inside a "div.dataTables_borderWrap" element

            //"iDisplayLength": 50
        });
        /**
        var tableTools = new $.fn.dataTable.TableTools( oTable1, {
            "sSwfPath": "../../copy_csv_xls_pdf.swf",
            "buttons": [
                "copy",
                "csv",
                "xls",
                "pdf",
                "print"
            ]
        } );
        $( tableTools.fnContainer() ).insertBefore('#ajax_list');
        */


        $(document).on('click', 'th input:checkbox' , function(){
            var that = this;
            $(this).closest('table').find('tr > td:first-child input:checkbox')
            .each(function(){
                this.checked = that.checked;
                $(this).closest('tr').toggleClass('selected');
            });
        });


        $('[data-rel="tooltip"]').tooltip({placement: tooltip_placement});
        function tooltip_placement(context, source) {
            var $source = $(source);
            var $parent = $source.closest('table')
            var off1 = $parent.offset();
            var w1 = $parent.width();

            var off2 = $source.offset();
            //var w2 = $source.width();

            if( parseInt(off2.left) < parseInt(off1.left) + parseInt(w1 / 2) ) return 'right';
            return 'left';
        }

    });
</script>


<script type="text/javascript">
// the delete button
        jQuery(function($) {

            $(".del_ajax").on('click', function (e) {
                e.preventDefault();

                $del_name = $(this).attr('name');   // so beautiful here!

                $("#dialog-confirm").removeClass('hide').dialog({
                    resizable: false,
                    modal: true,
                    title: "注意！",
                    buttons: [
                        {
                            html: "<i class='ace-icon fa fa-trash-o bigger-110'></i>&nbsp; 确认！",
                            "class": "btn btn-danger btn-xs",
                            click: function () {
                                $(this).dialog("close");
                                $.ajax({
                                    url: '{% url 'user_delete_ajax' %}',
                                    context: '',
                                    type: "GET",
                                    dataType: "html",
                                    data: {'del_id': $del_name},
                                    success: function(ans){
                                        // $("#ajax_list").html(ans);
                                        $('#ajax_list').dataTable().fnDeleteRow($("#" + $del_name));
                                        // $("#" + $del_name).remove();
                                    }
                                });
                            }
                        }
                        ,
                        {
                            html: "<i class='ace-icon fa fa-times bigger-110'></i>&nbsp; 取消",
                            "class": "btn btn-xs",
                            click: function () {
                                $(this).dialog("close");
                            }
                        }
                    ]
                });
            });
        })
    </script>

{% endblock other_js%}
